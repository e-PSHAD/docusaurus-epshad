<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-developpement/migrations">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<title data-rh="true">Migrations | PAD+</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://e-PSHAD.github.io/pad-doc/developpement/migrations"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Migrations | PAD+"><meta data-rh="true" name="description" content="Cette page récapitule les informations essentielles pour la mise à jour du code et les migrations de version Moodle."><meta data-rh="true" property="og:description" content="Cette page récapitule les informations essentielles pour la mise à jour du code et les migrations de version Moodle."><link data-rh="true" rel="icon" href="/pad-doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://e-PSHAD.github.io/pad-doc/developpement/migrations"><link data-rh="true" rel="alternate" href="https://e-PSHAD.github.io/pad-doc/developpement/migrations" hreflang="en"><link data-rh="true" rel="alternate" href="https://e-PSHAD.github.io/pad-doc/developpement/migrations" hreflang="x-default"><link rel="stylesheet" href="/pad-doc/assets/css/styles.3954c2f0.css">
<link rel="preload" href="/pad-doc/assets/js/runtime~main.52d6d0a4.js" as="script">
<link rel="preload" href="/pad-doc/assets/js/main.25f7dcc4.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/pad-doc/"><div class="navbar__logo"><img src="/pad-doc/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/pad-doc/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">PAD+ Documentation technique</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/e-PSHAD/pad-doc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pad-doc/">Accueil</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pad-doc/survol">Survol d&#x27;une instance PAD+</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/pad-doc/installation/deploiement">Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/pad-doc/marqueblanche/presentation">Marque blanche</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/pad-doc/organisation/contenu">Organisation, données, rôles</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/pad-doc/legal/politiques">Politiques d&#x27;utilisation et RGPD</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/pad-doc/developpement/features">Développement</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pad-doc/developpement/features">Fonctionnalités PAD+</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pad-doc/developpement/guide">Guide du développeur</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pad-doc/developpement/setup-local">Environnement local</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pad-doc/developpement/custom-lang">Personnalisation de la langue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/pad-doc/developpement/migrations">Migrations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pad-doc/developpement/studies">Etudes prospectives</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pad-doc/doc-edition">Edition de la documentation</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/pad-doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Développement</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Migrations</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Migrations</h1><p>Cette page récapitule les informations essentielles pour la mise à jour du code et les migrations de version Moodle.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mise-à-jour-du-code-depuis-le-dépôt">Mise à jour du code depuis le dépôt<a class="hash-link" href="#mise-à-jour-du-code-depuis-le-dépôt" title="Direct link to heading">​</a></h2><p>A titre d&#x27;exemple, voici les étapes d&#x27;une mise à jour entre le <a href="https://github.com/e-PSHAD/PAD" target="_blank" rel="noopener noreferrer">dépôt Github PAD</a> et le serveur démo.</p><ol><li>Le serveur est placé en <a href="https://docs.moodle.org/311/en/Maintenance_mode" target="_blank" rel="noopener noreferrer">mode maintenance (MoodleDoc)</a> pour prévenir les accès des utilisateurs pendant la mise à jour (sauf administrateurs).</li><li>Une commande rsync est lancée pour synchroniser les fichiers serveurs avec la version courante du dépôt.</li><li>Le script <code>/admin/cli/upgrade.php</code> de Moodle est appelé sur le serveur au cas où une migration de versions soit nécessaire.</li><li>Tous les caches Moodle sont purgés.</li><li>Le mode maintenance est désactivé pour rouvrir l&#x27;accès aux utilisateurs.</li></ol><p>Ces étapes sont définis dans un <a href="https://github.com/e-PSHAD/PAD/actions/workflows/upgrade-pad.yml" target="_blank" rel="noopener noreferrer">workflow Github Actions</a> et exécutées quand la branche de déploiement (ici <code>pad-eig</code>) est mise à jour. Elle nécessite l&#x27;installation d&#x27;une clé SSH sur Github et le serveur cible.</p><p>L&#x27;étape 3 ne déclenche pas systématiquement une migration. En effet il faut un changement de versions des plugins pour que Moodle effectue une migration. C&#x27;est nécessaire en particulier dès qu&#x27;il s&#x27;agit de modifier la base de données, de déclarer des services web, de nouvelles permissions ou notifications... Dans le cas où il s&#x27;agit d&#x27;une simple mise à jour des fichiers (cas courant pour les tests &amp; démos en préproduction), l&#x27;étape 3 ne fera rien et l&#x27;étape 4 de purge des caches suffit.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-mineure-de-moodle">Migration mineure de Moodle<a class="hash-link" href="#migration-mineure-de-moodle" title="Direct link to heading">​</a></h2><p>Les mises à jour sont annoncées sur la page officielle des <a href="https://moodle.org/news/" target="_blank" rel="noopener noreferrer">nouvelles de la communauté Moodle</a>. Elles sont aussi visibles sur chaque instance via la page <em>Administration du site / Notifications</em> (qui scanne aussi les mises à jours des plugins externes). Dans le cas de la PAD+, la façon la plus simple de récupérer ces mises à jour est via le <a href="https://github.com/moodle/moodle" target="_blank" rel="noopener noreferrer">miroir officiel sur GitHub</a> où elles apparaissent via des tags git (voir la procédure ci-dessous).</p><p>Le mécanisme de surcharge des thèmes permet de customiser Moodle sans changer directement le code (dans la plupart des cas). Mais cela rend aussi plus délicat le suivi des évolutions du code original, car les mises à jour impactantes apparaissent indirectement dans le gestionnaire de version. La détection de régression peut se faire en lisant les release notes, guides de migration, avec des tests de non-régression, et en comparant les <a href="/pad-doc/developpement/guide#details-changements">changements PAD+ apportés au code original</a> et les nouveaux changements.</p><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Migration irréversible</h5></div><div class="admonition-content"><p>Moodle ne permet pas de faire des migrations descendantes sur la base de données. Autrement dit, toute migration est irréversible. Il est donc fortement recommandé de faire des sauvegardes de la base de données et de tester les migrations sur une copie de la base avant toute tentative en production.</p></div></div><p>Les procédures décrites ci-dessous sont prévues pour la <strong>mise à jour d&#x27;un <a href="/pad-doc/developpement/setup-local">environnement local sous git</a></strong> pour les tests, avant synchronisation du code et migration en production.</p><p>La procédure technique de mise à jour sous git est relativement simple :</p><ol><li>Ajouter le dépôt original Moodle comme <a href="https://git-scm.com/docs/git-remote" target="_blank" rel="noopener noreferrer">dépôt distant</a> (par exemple <code>git remote add upstream https://github.com/moodle/moodle</code>).</li><li>Récupérer les dernières versions de Moodle (<code>git fetch upstream</code> ou <code>git fetch --all</code>).</li><li>Lancer la fusion avec le commit de la version Moodle visée (par exemple <code>git merge v3.11.7</code> pour le tag <code>v3.11.7</code>). Il faut <em>résoudre les conflits éventuels</em> à cette étape avant de continuer.</li><li>Aller sur l&#x27;interface d&#x27;administration pour que Moodle détecte le changement de version et lance la migration.</li><li>Commencer les tests de non-régression.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cas-dun-plugin-externe-bigbluebuttonbn">Cas d&#x27;un plugin externe (BigBlueButtonBN)<a class="hash-link" href="#cas-dun-plugin-externe-bigbluebuttonbn" title="Direct link to heading">​</a></h3><p>Pour la mise à jour d&#x27;un plugin externe comme BigBlueButton, il est recommandé de procéder différemment.</p><ol><li>Récupérer <a href="https://moodle.org/plugins/mod_bigbluebuttonbn" target="_blank" rel="noopener noreferrer">l&#x27;archive du plugin</a>.</li><li>Supprimer le code de l&#x27;ancien plugin sous <code>mod/bigbluebuttonbn</code> (pour éviter de laisser des fichiers orphelins qui n&#x27;existent plus dans la nouvelle version).</li><li>Placer le contenu de l&#x27;archive sous <code>mod/bigbluebuttonbn</code>.</li><li>Aller sur l&#x27;interface d&#x27;administration pour que Moodle détecte le changement de version du plugin et lance la migration.</li><li>Commiter les changements si c&#x27;est ok.</li></ol><p>Si un plugin externe pose problème et qu&#x27;un retour en arrière soit nécessaire, la seule solution est de le désinstaller pour réinstaller une version antérieure. L&#x27;étape 3 ci-dessous est indispensable car Moodle n&#x27;acceptera pas d&#x27;installer une version antérieure à la version enregistrée dans sa base. Ceci implique de supprimer les données liées au plugin.</p><ol><li>Supprimer les fichiers du plugin.</li><li>Aller sur <em>Administration du site / Plugins / <strong>Vue d&#x27;ensemble des plugins</strong> </em>.</li><li>Chercher le plugin dans la liste (il apparaît en rouge car &quot;Absent du disque dur&quot;) et <strong>Désinstaller le plugin</strong> puis confirmer la suppression du plugin et de ses données.</li><li>Placer la version antérieure du plugin.</li><li>Aller sur l&#x27;interface d&#x27;administration pour que Moodle détecte le &quot;nouveau&quot; plugin et lance l&#x27;installation.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-vers-moodle-4">Migration vers Moodle 4<a class="hash-link" href="#migration-vers-moodle-4" title="Direct link to heading">​</a></h2><p>La mise à jour majeure de Moodle 4 met l&#x27;accent sur une <a href="https://docs.moodle.org/400/en/New_features" target="_blank" rel="noopener noreferrer">refonte de la disposition graphique et de la navigation (MoodleDoc)</a>. En théorie, la <a href="https://docs.moodle.org/400/en/Upgrading" target="_blank" rel="noopener noreferrer">procédure de mise à jour (MoodleDoc)</a> est la même que pour une mise à jour mineure. En pratique, vu l&#x27;importance des changements de la PAD+, elle demande une approche plus minutieuse de chaque changement. Cette section fait le point sur les éléments a priori impactant pour la PAD+.</p><p>Autres sources d&#x27;information :</p><ul><li>les <a href="https://moodledev.io/general/releases/4.0" target="_blank" rel="noopener noreferrer">Release notes de la version 4</a> pour une liste complète des changements ;</li><li>les <a href="https://moodledev.io/docs/devupdate" target="_blank" rel="noopener noreferrer">notes aux développeurs</a> contiennent des indications plus précises sur les changements impactant.</li><li>on trouve dans chaque plugin Moodle un fichier <code>upgrade.txt</code> qui donne des indications spécifiques sur les changements de versions.</li></ul><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Etude des impacts</h5></div><div class="admonition-content"><p>De façon générale, les changements importants dans l&#x27;interface de Moodle 4 imposent de réévaluer une bonne partie des choix faits pour la PAD+ basée sur Moodlee 3.11. En s&#x27;aidant du <a href="/pad-doc/developpement/guide">guide du développeur</a>, il faut reprendre chaque élément et décider si le changement est obsolète ou doit être porté sur Moodle 4. C&#x27;est valable pour les plugins, les modifications profondes du code (bloc &quot;vue d&#x27;ensemble des séquences&quot;) comme pour les surcharges de structure et de style dans le thème. On fera aussi attention aux <a href="#bigbluebutton-moodle4">extensions de BigBlueButtonBN</a>, qui voit une refonte en profondeur dans Moodle 4.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="apparence-structure-rendu-thème">Apparence, structure, rendu (thème)<a class="hash-link" href="#apparence-structure-rendu-thème" title="Direct link to heading">​</a></h3><p>En raison du nombre de changements touchant de multiples endroits, cette phase demande sans doute le plus d&#x27;attention. On gardera en tête les objectifs globaux :</p><ul><li>l&#x27;implémentation de la marque blanche dans les styles, en particulier le respect de la couleur primaire ;</li><li>la simplification du design des pages catégories, séquences, séances et les spécificités des ateliers complémentaires</li><li>la clarification de la navigation entre séances et activités, par le fil d&#x27;Ariane, pour l&#x27;accès aux réglages des pages (page d&#x27;accueil, administration de la séquence, préférences utilisateurs), ...</li></ul><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Procédure de migration</h5></div><div class="admonition-content"><p>Il est tout à fait possible que la mise à jour brute par un <code>git merge v4.0.0</code> ne permette pas d&#x27;avoir une plateforme fonctionnelle de suite à cause de problèmes dans le code ou dans l&#x27;affichage. La solution proposée est une approche basique à la &quot;Feature Flag&quot;. Après l&#x27;intégration dans l&#x27;historique git (git merge finalisé) :</p><ul><li>désactiver toutes les surcharges PAD+ (mise en commentaire des méthodes surchargées, mise de côté des modèles mustache et styles scss surchargées) ;</li><li>les réactiver une par une, en corrigeant au fur et à mesure les problèmes.</li></ul><p>C&#x27;est une approche incrémentale qui permet de garder un regard critique sur les changements à conserver. Elle demande cependant une bonne <a href="/pad-doc/developpement/guide">compréhension des changements du code</a> à l&#x27;aide des <a href="/pad-doc/developpement/guide#details-changements">indices et de l&#x27;historique de développement</a>.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="accessibilité-et-responsive-design">Accessibilité et responsive design<a class="hash-link" href="#accessibilité-et-responsive-design" title="Direct link to heading">​</a></h4><p>Pour chaque intégration d&#x27;une fonctionnalité, il est conseillé de faire des vérifications sur l&#x27;accessibilité et le responsive design, pour ne pas laisser ces aspects de côté. Sans être exhaustif, il s&#x27;agit par exemple de respecter la sémantique des balises HTML, l&#x27;ordre d&#x27;affichage, la navigation au clavier, le zoom sur les textes, l&#x27;affichage sur différentes tailles d&#x27;écrans (avec les outils développeurs des navigateurs). Le <a href="https://design.numerique.gouv.fr/outils/" target="_blank" rel="noopener noreferrer">pôle design des services numériques de l&#x27;état propose plusieurs ressources</a> pour tester ces aspects, tel que le <a href="https://design.numerique.gouv.fr/outils/diagnostic-flash/" target="_blank" rel="noopener noreferrer">diagnostic flash</a> ou la <a href="https://design.numerique.gouv.fr/outils/checklist-pidila/" target="_blank" rel="noopener noreferrer">checklist PiDila</a> (en ignorant les aspects propres aux sites gouvernementaux).</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Breakpoints responsive design</h5></div><div class="admonition-content"><p>Pour l&#x27;affichage des extensions PAD+ sur différentes tailles d&#x27;écran, les trois principaux breakpoints utilisés sont : <strong>1389px, 1289px, 1042px</strong>. Cependant d&#x27;autres breakpoints sont utilisés au cas par cas dans des requêtes <code>@media screen</code>. Le responsive design de Moodle fait le reste.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="navigation-latérale">Navigation latérale<a class="hash-link" href="#navigation-latérale" title="Direct link to heading">​</a></h4><p>La navigation est un des changements les plus visibles dans Moodle 4. Le menu latéral a été profondément remanié :</p><ul><li>la navigation globale du site se retrouve dans la barre du haut, qui devient la barre de principale de navigation ;</li><li>la navigation vers les pages annexes d&#x27;une séquence (participants, évaluations) se retrouvent dans un menu d&#x27;onglets dans le corps de la séquence ;</li><li>la navigation latérale ne montre plus que la structure des séances et activités de la séquence (cette information était cachée dans la PAD+ pour ne pas surcharger le menu latéral).</li></ul><p>La nouvelle disposition répond à l&#x27;objectif de clarté et de simplicité visé pour la navigation de la PAD+ (qui était un compromis par rapport à l&#x27;ancienne conception technique). Il est donc proposé d&#x27;utiliser cette nouvelle disposition en ajoutant les éléments manquants :</p><ul><li>liens vers la page parcours et les catégories disponibles pour les usagers dans la navigation du haut (toutes les séquences, ateliers complémentaires, ressources professionnelles, ...)</li><li>revoir l&#x27;accès simplifié aux pages annexes dans le menu des onglets (rapports d&#x27;activité et d&#x27;achèvement)</li></ul><p><img loading="lazy" alt="Correspondance de la navigation latérale entre la PAD+ et Moodle 4" src="/pad-doc/assets/images/migration-navigation-24438d7d537581483595614c6a936396.png" width="2600" height="825" class="img_ev3q"></p><p>Dans ce but il faut à la fois vérifier les éventuels changements au mécanisme d&#x27;extensions de la navigation et corriger les modèles et styles surchargés, dont certains peuvent être obsolètes.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="icônes-fontawesome">Icônes FontAwesome<a class="hash-link" href="#icônes-fontawesome" title="Direct link to heading">​</a></h4><p>La bibliothèque FontAwesome du thème Boost n&#x27;a pas changé dans Moodle 4. Il s&#x27;agit toujours de la version 4.7. Pour rappel, la PAD+ exploite la version 5. Il faut donc vérifier que cette version reste bien intégrée lors de la migration.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bigbluebutton-moodle4">Plugin BigBlueButtonBN et extensions visioconférence<a class="hash-link" href="#bigbluebutton-moodle4" title="Direct link to heading">​</a></h3><p>Le plugin BigBlueButtonBN n&#x27;est plus un plugin externe mais est directement intégré à Moodle 4. Cependant il a fait l&#x27;objet d&#x27;une réécriture en profondeur pour cette intégration. Cette réécriture devrait aussi faire l&#x27;objet d&#x27;une <a href="https://github.com/blindsidenetworks/moodle-mod_bigbluebuttonbn" target="_blank" rel="noopener noreferrer">release 3.0 pour Moodle 3.11</a>.</p><p>Cela implique des adaptations pour les fonctionnalités visioconférence spécifiques de la PAD+ (bloc visioconférence et appel vidéo page profil), qui ont été développées sur la base de la version stable 2.4 du plugin BigBlueButtonBN. Il ne s&#x27;agit pas de changements en profondeur mais d&#x27;une adaptation des APIs, qui demandent cependant d&#x27;être étudiée avec un peu d&#x27;attention.</p><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Procédure de migration</h5></div><div class="admonition-content"><p>La procédure proposée est spécifique.</p><ul><li><a href="#cas-dun-plugin-externe-bigbluebuttonbn">Supprimer le plugin BigBlueButtonBN</a> avant l&#x27;intégration Moodle 4.</li><li>Si besoin désactiver/supprimer les extensions PAD+ liées à BigBlueButtonBN (par exemple enlever le bloc, enlever les dépendances entre plugins) pour éviter les erreurs liés aux fichiers manquant.</li><li>Intégrer Moodle 4.</li><li>Adapter les fonctions du plugin <code>blocks/padplusvideocall</code> à l&#x27;API Moodle 4.</li></ul></div></div><p>Les impacts des changements dans la PAD+ devraient être cependant limités.</p><ul><li>Il s&#x27;agit des fichiers <code>blocks/padplusvideocall/lib.php</code> et <code>blocks/padplusvideocall/bbbpad_videocall.php</code>, qui font tous les deux appellent aux fonctions <code>bigbluebuttonbn_*</code> définies dans <code>mod/bigbluebuttonbn/locallib.php</code>.</li><li>Sous Moodle 4, ces fonctions sont transformées en méthodes dans les classes <code>plugin</code>, <code>meeting</code> et <code>bigbluebutton_proxy</code>. Le tableau ci-dessous donne quelques correspondances pour démarrer mais il faut cependant creuser la compatibilité des instances et des paramètres. Si la classe <code>bigbluebutton_proxy</code> est triviale à utiliser, c&#x27;est moins le cas pour la classe <code>meeting</code>, qui est liée aux <code>instances</code> des activités BigBlueButton dans les séquences (ce qui n&#x27;est pas le cas pour les visioconférences directes du tableau de bord et des pages profil). Quelques fonctions seraient possiblement à extraire pour retrouver une certaine indépendance.</li></ul><table><caption>Migration vers l&#x27;API BigBlueButtonBN de Moodle 4.</caption><thead><tr><th scope="col">Fichier PAD+ <code>blocks/padplusvideocall</code></th><th scope="col">Appel à BigBlueButtonBN 2.4 (actuel)</th><th scope="col">Appel à BigBlueButtonBN 3 / Moodle 4</th></tr></thead><tbody><tr><td><code>lib.php</code></td><td><code>bigbluebuttonbn_random_password</code></td><td>équivalent à <code>plugin::random_password</code> dans <code>classes/plugin.php</code></td></tr><tr><td rowspan="4" scope="rowgroup"><code>bbbpad_videocall.php</code></td><td><code>bigbluebuttonbn_is_meeting_running</code></td><td>voir <code>is_running</code> dans <code>classes/meeting.php</code></td></tr><tr><td><code>bigbluebuttonbn_get_create_meeting_array</code></td><td>voir <code>create_meeting_data</code> dans <code>classes/meeting.php</code></td></tr><tr><td><code>bigbluebuttonbn_get_error_key</code></td><td>supprimée, voir <code>bigbluebutton_exception</code> dans <code>classes/bigbluebutton_proxy.php #create_meeting</code></td></tr><tr><td><code>bigbluebuttonbn_get_join_url</code></td><td>voir <code>get_join_url</code> dans <code>classes/bigbluebutton_proxy.php</code></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="page-mes-séquences">Page &quot;Mes séquences&quot;<a class="hash-link" href="#page-mes-séquences" title="Direct link to heading">​</a></h3><p>La page &quot;Mes séquences&quot; est une nouveauté de Moodle 4. La page &quot;Mes séquences&quot; de la PAD+ est un rétroportage. Certains développements liés à cette page deviennent par conséquent obsolète (page <code>my/courses.php</code>, classes <code>mycourses_renderer.php</code> et <code>mycourses_viewed.php</code> par exemple) et doivent être remplacés par la nouvelle version Moodle 4.</p><p>Par contre, cette page reste basée sur le bloc &quot;Vue d&#x27;ensemble des séquence&quot;, qui est la partie la plus impactée par les modifications invasives de la PAD+. Il convient là de reconsidérer et tester si les <a href="/pad-doc/developpement/guide#mes-s%C3%A9quences-et-bloc-vue-densemble">changements de la PAD+ sur le bloc &quot;Vue d&#x27;ensemble&quot;</a> sont bien compatibles sous Moodle 4. Pour rappel, ces modifications sont importantes pour simplifier l&#x27;usage de la page &quot;Mes séquences&quot; et la customiser pour l&#x27;accès aux ressources professionnelles.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tableau-de-bord">Tableau de bord<a class="hash-link" href="#tableau-de-bord" title="Direct link to heading">​</a></h3><p>Le tableau de bord par défaut de Moodle 4 est allégé pour afficher en priorité les événements et le calendrier. La vue d&#x27;ensemble des séquences est déléguée à la page &quot;Mes séquences&quot;, qui peut d&#x27;ailleurs être désignée comme page initiale pour les utilisateurs (sous <em>Administration du site / Présentation / Navigation</em>). Il y a donc quelques choix à reconsidérer :</p><ul><li>la page &quot;Mes séquences&quot; doit-elle devenir la page initiale à la place du tableau de bord ?</li><li>quels blocs sont à afficher sur le tableau de bord ?</li></ul><p>Il faut noter que seul le tableau de bord peut accueillir les blocs &quot;Progression du stagiaire&quot; et &quot;Visioconférence&quot;, ce qui peut faire pencher la balance pour garder le tableau de bord comme page initiale.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/e-PSHAD/pad-doc/edit/main/docs/developpement/migrations.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/pad-doc/developpement/custom-lang"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Personnalisation de la langue</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/pad-doc/developpement/studies"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Etudes prospectives</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mise-à-jour-du-code-depuis-le-dépôt" class="table-of-contents__link toc-highlight">Mise à jour du code depuis le dépôt</a></li><li><a href="#migration-mineure-de-moodle" class="table-of-contents__link toc-highlight">Migration mineure de Moodle</a><ul><li><a href="#cas-dun-plugin-externe-bigbluebuttonbn" class="table-of-contents__link toc-highlight">Cas d&#39;un plugin externe (BigBlueButtonBN)</a></li></ul></li><li><a href="#migration-vers-moodle-4" class="table-of-contents__link toc-highlight">Migration vers Moodle 4</a><ul><li><a href="#apparence-structure-rendu-thème" class="table-of-contents__link toc-highlight">Apparence, structure, rendu (thème)</a></li><li><a href="#bigbluebutton-moodle4" class="table-of-contents__link toc-highlight">Plugin BigBlueButtonBN et extensions visioconférence</a></li><li><a href="#page-mes-séquences" class="table-of-contents__link toc-highlight">Page &quot;Mes séquences&quot;</a></li><li><a href="#tableau-de-bord" class="table-of-contents__link toc-highlight">Tableau de bord</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Sources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/e-PSHAD/pad-doc" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Pad-doc<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tutorial.docusaurus.io/docs/intro" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tutorial Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/markdown-features" target="_blank" rel="noopener noreferrer" class="footer__link-item">Markdown<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Communauté</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 e-PSHAD. Built with Docusaurus.</div></div></div></footer></div>
<script src="/pad-doc/assets/js/runtime~main.52d6d0a4.js"></script>
<script src="/pad-doc/assets/js/main.25f7dcc4.js"></script>
</body>
</html>