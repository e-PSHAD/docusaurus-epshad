"use strict";(self.webpackChunkdoc_epshad=self.webpackChunkdoc_epshad||[]).push([[869],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var o=a.createContext({}),u=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(o.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,s=e.originalType,o=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),c=u(n),m=i,g=c["".concat(o,".").concat(m)]||c[m]||p[m]||s;return n?a.createElement(g,l(l({ref:t},d),{},{components:n})):a.createElement(g,l({ref:t},d))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var s=n.length,l=new Array(s);l[0]=c;var r={};for(var o in t)hasOwnProperty.call(t,o)&&(r[o]=t[o]);r.originalType=e,r.mdxType="string"==typeof e?e:i,l[1]=r;for(var u=2;u<s;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},4668:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>u});var a=n(7462),i=(n(7294),n(3905));const s={sidebar_position:15},l="Migrations",r={unversionedId:"developpement/migrations",id:"developpement/migrations",title:"Migrations",description:"Cette page r\xe9capitule les informations essentielles pour la mise \xe0 jour du code et les migrations de version Moodle.",source:"@site/docs/developpement/migrations.md",sourceDirName:"developpement",slug:"/developpement/migrations",permalink:"/pad-doc/developpement/migrations",draft:!1,editUrl:"https://github.com/e-PSHAD/pad-doc/edit/main/docs/developpement/migrations.md",tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15},sidebar:"tutorialSidebar",previous:{title:"Personnalisation de la langue",permalink:"/pad-doc/developpement/custom-lang"},next:{title:"Etudes prospectives",permalink:"/pad-doc/developpement/studies"}},o={},u=[{value:"Mise \xe0 jour du code depuis le d\xe9p\xf4t",id:"mise-\xe0-jour-du-code-depuis-le-d\xe9p\xf4t",level:2},{value:"Migration mineure de Moodle",id:"migration-mineure-de-moodle",level:2},{value:"Cas d&#39;un plugin externe (BigBlueButtonBN)",id:"cas-dun-plugin-externe-bigbluebuttonbn",level:3},{value:"Migration vers Moodle 4",id:"migration-vers-moodle-4",level:2},{value:"Apparence, structure, rendu (th\xe8me)",id:"apparence-structure-rendu-th\xe8me",level:3},{value:"Accessibilit\xe9 et responsive design",id:"accessibilit\xe9-et-responsive-design",level:4},{value:"Navigation lat\xe9rale",id:"navigation-lat\xe9rale",level:4},{value:"Ic\xf4nes FontAwesome",id:"ic\xf4nes-fontawesome",level:4},{value:"Plugin BigBlueButtonBN et extensions visioconf\xe9rence",id:"bigbluebutton-moodle4",level:3},{value:"Page &quot;Mes s\xe9quences&quot;",id:"page-mes-s\xe9quences",level:3},{value:"Tableau de bord",id:"tableau-de-bord",level:3}],d={toc:u};function p(e){let{components:t,...s}=e;return(0,i.kt)("wrapper",(0,a.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"migrations"},"Migrations"),(0,i.kt)("p",null,"Cette page r\xe9capitule les informations essentielles pour la mise \xe0 jour du code et les migrations de version Moodle."),(0,i.kt)("h2",{id:"mise-\xe0-jour-du-code-depuis-le-d\xe9p\xf4t"},"Mise \xe0 jour du code depuis le d\xe9p\xf4t"),(0,i.kt)("p",null,"A titre d'exemple, voici les \xe9tapes d'une mise \xe0 jour entre le ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/e-PSHAD/PAD"},"d\xe9p\xf4t Github PAD")," et le serveur d\xe9mo."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Le serveur est plac\xe9 en ",(0,i.kt)("a",{parentName:"li",href:"https://docs.moodle.org/311/en/Maintenance_mode"},"mode maintenance (MoodleDoc)")," pour pr\xe9venir les acc\xe8s des utilisateurs pendant la mise \xe0 jour (sauf administrateurs)."),(0,i.kt)("li",{parentName:"ol"},"Une commande rsync est lanc\xe9e pour synchroniser les fichiers serveurs avec la version courante du d\xe9p\xf4t."),(0,i.kt)("li",{parentName:"ol"},"Le script ",(0,i.kt)("inlineCode",{parentName:"li"},"/admin/cli/upgrade.php")," de Moodle est appel\xe9 sur le serveur au cas o\xf9 une migration de versions soit n\xe9cessaire."),(0,i.kt)("li",{parentName:"ol"},"Tous les caches Moodle sont purg\xe9s."),(0,i.kt)("li",{parentName:"ol"},"Le mode maintenance est d\xe9sactiv\xe9 pour rouvrir l'acc\xe8s aux utilisateurs.")),(0,i.kt)("p",null,"Ces \xe9tapes sont d\xe9finis dans un ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/e-PSHAD/PAD/actions/workflows/upgrade-pad.yml"},"workflow Github Actions")," et ex\xe9cut\xe9es quand la branche de d\xe9ploiement (ici ",(0,i.kt)("inlineCode",{parentName:"p"},"pad-eig"),") est mise \xe0 jour. Elle n\xe9cessite l'installation d'une cl\xe9 SSH sur Github et le serveur cible."),(0,i.kt)("p",null,"L'\xe9tape 3 ne d\xe9clenche pas syst\xe9matiquement une migration. En effet il faut un changement de versions des plugins pour que Moodle effectue une migration. C'est n\xe9cessaire en particulier d\xe8s qu'il s'agit de modifier la base de donn\xe9es, de d\xe9clarer des services web, de nouvelles permissions ou notifications... Dans le cas o\xf9 il s'agit d'une simple mise \xe0 jour des fichiers (cas courant pour les tests & d\xe9mos en pr\xe9production), l'\xe9tape 3 ne fera rien et l'\xe9tape 4 de purge des caches suffit."),(0,i.kt)("h2",{id:"migration-mineure-de-moodle"},"Migration mineure de Moodle"),(0,i.kt)("p",null,"Les mises \xe0 jour sont annonc\xe9es sur la page officielle des ",(0,i.kt)("a",{parentName:"p",href:"https://moodle.org/news/"},"nouvelles de la communaut\xe9 Moodle"),". Elles sont aussi visibles sur chaque instance via la page ",(0,i.kt)("em",{parentName:"p"},"Administration du site / Notifications")," (qui scanne aussi les mises \xe0 jours des plugins externes). Dans le cas de la PAD+, la fa\xe7on la plus simple de r\xe9cup\xe9rer ces mises \xe0 jour est via le ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/moodle/moodle"},"miroir officiel sur GitHub")," o\xf9 elles apparaissent via des tags git (voir la proc\xe9dure ci-dessous)."),(0,i.kt)("p",null,"Le m\xe9canisme de surcharge des th\xe8mes permet de customiser Moodle sans changer directement le code (dans la plupart des cas). Mais cela rend aussi plus d\xe9licat le suivi des \xe9volutions du code original, car les mises \xe0 jour impactantes apparaissent indirectement dans le gestionnaire de version. La d\xe9tection de r\xe9gression peut se faire en lisant les release notes, guides de migration, avec des tests de non-r\xe9gression, et en comparant les ",(0,i.kt)("a",{parentName:"p",href:"guide#details-changements"},"changements PAD+ apport\xe9s au code original")," et les nouveaux changements."),(0,i.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Migration irr\xe9versible")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Moodle ne permet pas de faire des migrations descendantes sur la base de donn\xe9es. Autrement dit, toute migration est irr\xe9versible. Il est donc fortement recommand\xe9 de faire des sauvegardes de la base de donn\xe9es et de tester les migrations sur une copie de la base avant toute tentative en production."))),(0,i.kt)("p",null,"Les proc\xe9dures d\xe9crites ci-dessous sont pr\xe9vues pour la ",(0,i.kt)("strong",{parentName:"p"},"mise \xe0 jour d'un ",(0,i.kt)("a",{parentName:"strong",href:"setup-local"},"environnement local sous git"))," pour les tests, avant synchronisation du code et migration en production."),(0,i.kt)("p",null,"La proc\xe9dure technique de mise \xe0 jour sous git est relativement simple :"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Ajouter le d\xe9p\xf4t original Moodle comme ",(0,i.kt)("a",{parentName:"li",href:"https://git-scm.com/docs/git-remote"},"d\xe9p\xf4t distant")," (par exemple ",(0,i.kt)("inlineCode",{parentName:"li"},"git remote add upstream https://github.com/moodle/moodle"),")."),(0,i.kt)("li",{parentName:"ol"},"R\xe9cup\xe9rer les derni\xe8res versions de Moodle (",(0,i.kt)("inlineCode",{parentName:"li"},"git fetch upstream")," ou ",(0,i.kt)("inlineCode",{parentName:"li"},"git fetch --all"),")."),(0,i.kt)("li",{parentName:"ol"},"Lancer la fusion avec le commit de la version Moodle vis\xe9e (par exemple ",(0,i.kt)("inlineCode",{parentName:"li"},"git merge v3.11.7")," pour le tag ",(0,i.kt)("inlineCode",{parentName:"li"},"v3.11.7"),"). Il faut ",(0,i.kt)("em",{parentName:"li"},"r\xe9soudre les conflits \xe9ventuels")," \xe0 cette \xe9tape avant de continuer."),(0,i.kt)("li",{parentName:"ol"},"Aller sur l'interface d'administration pour que Moodle d\xe9tecte le changement de version et lance la migration."),(0,i.kt)("li",{parentName:"ol"},"Commencer les tests de non-r\xe9gression.")),(0,i.kt)("h3",{id:"cas-dun-plugin-externe-bigbluebuttonbn"},"Cas d'un plugin externe (BigBlueButtonBN)"),(0,i.kt)("p",null,"Pour la mise \xe0 jour d'un plugin externe comme BigBlueButton, il est recommand\xe9 de proc\xe9der diff\xe9remment."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"R\xe9cup\xe9rer ",(0,i.kt)("a",{parentName:"li",href:"https://moodle.org/plugins/mod_bigbluebuttonbn"},"l'archive du plugin"),"."),(0,i.kt)("li",{parentName:"ol"},"Supprimer le code de l'ancien plugin sous ",(0,i.kt)("inlineCode",{parentName:"li"},"mod/bigbluebuttonbn")," (pour \xe9viter de laisser des fichiers orphelins qui n'existent plus dans la nouvelle version)."),(0,i.kt)("li",{parentName:"ol"},"Placer le contenu de l'archive sous ",(0,i.kt)("inlineCode",{parentName:"li"},"mod/bigbluebuttonbn"),"."),(0,i.kt)("li",{parentName:"ol"},"Aller sur l'interface d'administration pour que Moodle d\xe9tecte le changement de version du plugin et lance la migration."),(0,i.kt)("li",{parentName:"ol"},"Commiter les changements si c'est ok.")),(0,i.kt)("p",null,"Si un plugin externe pose probl\xe8me et qu'un retour en arri\xe8re soit n\xe9cessaire, la seule solution est de le d\xe9sinstaller pour r\xe9installer une version ant\xe9rieure. L'\xe9tape 3 ci-dessous est indispensable car Moodle n'acceptera pas d'installer une version ant\xe9rieure \xe0 la version enregistr\xe9e dans sa base. Ceci implique de supprimer les donn\xe9es li\xe9es au plugin."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Supprimer les fichiers du plugin."),(0,i.kt)("li",{parentName:"ol"},"Aller sur ",(0,i.kt)("em",{parentName:"li"},"Administration du site / Plugins / ",(0,i.kt)("strong",{parentName:"em"},"Vue d'ensemble des plugins")," "),"."),(0,i.kt)("li",{parentName:"ol"},'Chercher le plugin dans la liste (il appara\xeet en rouge car "Absent du disque dur") et ',(0,i.kt)("strong",{parentName:"li"},"D\xe9sinstaller le plugin")," puis confirmer la suppression du plugin et de ses donn\xe9es."),(0,i.kt)("li",{parentName:"ol"},"Placer la version ant\xe9rieure du plugin."),(0,i.kt)("li",{parentName:"ol"},"Aller sur l'interface d'administration pour que Moodle d\xe9tecte le \"nouveau\" plugin et lance l'installation.")),(0,i.kt)("h2",{id:"migration-vers-moodle-4"},"Migration vers Moodle 4"),(0,i.kt)("p",null,"La mise \xe0 jour majeure de Moodle 4 met l'accent sur une ",(0,i.kt)("a",{parentName:"p",href:"https://docs.moodle.org/400/en/New_features"},"refonte de la disposition graphique et de la navigation (MoodleDoc)"),". En th\xe9orie, la ",(0,i.kt)("a",{parentName:"p",href:"https://docs.moodle.org/400/en/Upgrading"},"proc\xe9dure de mise \xe0 jour (MoodleDoc)")," est la m\xeame que pour une mise \xe0 jour mineure. En pratique, vu l'importance des changements de la PAD+, elle demande une approche plus minutieuse de chaque changement. Cette section fait le point sur les \xe9l\xe9ments a priori impactant pour la PAD+."),(0,i.kt)("p",null,"Autres sources d'information :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"les ",(0,i.kt)("a",{parentName:"li",href:"https://moodledev.io/general/releases/4.0"},"Release notes de la version 4")," pour une liste compl\xe8te des changements ;"),(0,i.kt)("li",{parentName:"ul"},"les ",(0,i.kt)("a",{parentName:"li",href:"https://moodledev.io/docs/devupdate"},"notes aux d\xe9veloppeurs")," contiennent des indications plus pr\xe9cises sur les changements impactant."),(0,i.kt)("li",{parentName:"ul"},"on trouve dans chaque plugin Moodle un fichier ",(0,i.kt)("inlineCode",{parentName:"li"},"upgrade.txt")," qui donne des indications sp\xe9cifiques sur les changements de versions.")),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Etude des impacts")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"De fa\xe7on g\xe9n\xe9rale, les changements importants dans l'interface de Moodle 4 imposent de r\xe9\xe9valuer une bonne partie des choix faits pour la PAD+ bas\xe9e sur Moodlee 3.11. En s'aidant du ",(0,i.kt)("a",{parentName:"p",href:"guide"},"guide du d\xe9veloppeur"),", il faut reprendre chaque \xe9l\xe9ment et d\xe9cider si le changement est obsol\xe8te ou doit \xeatre port\xe9 sur Moodle 4. C'est valable pour les plugins, les modifications profondes du code (bloc \"vue d'ensemble des s\xe9quences\") comme pour les surcharges de structure et de style dans le th\xe8me. On fera aussi attention aux ",(0,i.kt)("a",{parentName:"p",href:"#bigbluebutton-moodle4"},"extensions de BigBlueButtonBN"),", qui voit une refonte en profondeur dans Moodle 4."))),(0,i.kt)("h3",{id:"apparence-structure-rendu-th\xe8me"},"Apparence, structure, rendu (th\xe8me)"),(0,i.kt)("p",null,"En raison du nombre de changements touchant de multiples endroits, cette phase demande sans doute le plus d'attention. On gardera en t\xeate les objectifs globaux :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"l'impl\xe9mentation de la marque blanche dans les styles, en particulier le respect de la couleur primaire ;"),(0,i.kt)("li",{parentName:"ul"},"la simplification du design des pages cat\xe9gories, s\xe9quences, s\xe9ances et les sp\xe9cificit\xe9s des ateliers compl\xe9mentaires"),(0,i.kt)("li",{parentName:"ul"},"la clarification de la navigation entre s\xe9ances et activit\xe9s, par le fil d'Ariane, pour l'acc\xe8s aux r\xe9glages des pages (page d'accueil, administration de la s\xe9quence, pr\xe9f\xe9rences utilisateurs), ...")),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Proc\xe9dure de migration")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Il est tout \xe0 fait possible que la mise \xe0 jour brute par un ",(0,i.kt)("inlineCode",{parentName:"p"},"git merge v4.0.0")," ne permette pas d'avoir une plateforme fonctionnelle de suite \xe0 cause de probl\xe8mes dans le code ou dans l'affichage. La solution propos\xe9e est une approche basique \xe0 la \"Feature Flag\". Apr\xe8s l'int\xe9gration dans l'historique git (git merge finalis\xe9) :"),(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},"d\xe9sactiver toutes les surcharges PAD+ (mise en commentaire des m\xe9thodes surcharg\xe9es, mise de c\xf4t\xe9 des mod\xe8les mustache et styles scss surcharg\xe9es) ;"),(0,i.kt)("li",{parentName:"ul"},"les r\xe9activer une par une, en corrigeant au fur et \xe0 mesure les probl\xe8mes.")),(0,i.kt)("p",{parentName:"div"},"C'est une approche incr\xe9mentale qui permet de garder un regard critique sur les changements \xe0 conserver. Elle demande cependant une bonne ",(0,i.kt)("a",{parentName:"p",href:"guide"},"compr\xe9hension des changements du code")," \xe0 l'aide des ",(0,i.kt)("a",{parentName:"p",href:"guide#details-changements"},"indices et de l'historique de d\xe9veloppement"),"."))),(0,i.kt)("h4",{id:"accessibilit\xe9-et-responsive-design"},"Accessibilit\xe9 et responsive design"),(0,i.kt)("p",null,"Pour chaque int\xe9gration d'une fonctionnalit\xe9, il est conseill\xe9 de faire des v\xe9rifications sur l'accessibilit\xe9 et le responsive design, pour ne pas laisser ces aspects de c\xf4t\xe9. Sans \xeatre exhaustif, il s'agit par exemple de respecter la s\xe9mantique des balises HTML, l'ordre d'affichage, la navigation au clavier, le zoom sur les textes, l'affichage sur diff\xe9rentes tailles d'\xe9crans (avec les outils d\xe9veloppeurs des navigateurs). Le ",(0,i.kt)("a",{parentName:"p",href:"https://design.numerique.gouv.fr/outils/"},"p\xf4le design des services num\xe9riques de l'\xe9tat propose plusieurs ressources")," pour tester ces aspects, tel que le ",(0,i.kt)("a",{parentName:"p",href:"https://design.numerique.gouv.fr/outils/diagnostic-flash/"},"diagnostic flash")," ou la ",(0,i.kt)("a",{parentName:"p",href:"https://design.numerique.gouv.fr/outils/checklist-pidila/"},"checklist PiDila")," (en ignorant les aspects propres aux sites gouvernementaux)."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Breakpoints responsive design")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Pour l'affichage des extensions PAD+ sur diff\xe9rentes tailles d'\xe9cran, les trois principaux breakpoints utilis\xe9s sont : ",(0,i.kt)("strong",{parentName:"p"},"1389px, 1289px, 1042px"),". Cependant d'autres breakpoints sont utilis\xe9s au cas par cas dans des requ\xeates ",(0,i.kt)("inlineCode",{parentName:"p"},"@media screen"),". Le responsive design de Moodle fait le reste."))),(0,i.kt)("h4",{id:"navigation-lat\xe9rale"},"Navigation lat\xe9rale"),(0,i.kt)("p",null,"La navigation est un des changements les plus visibles dans Moodle 4. Le menu lat\xe9ral a \xe9t\xe9 profond\xe9ment remani\xe9 :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"la navigation globale du site se retrouve dans la barre du haut, qui devient la barre de principale de navigation ;"),(0,i.kt)("li",{parentName:"ul"},"la navigation vers les pages annexes d'une s\xe9quence (participants, \xe9valuations) se retrouvent dans un menu d'onglets dans le corps de la s\xe9quence ;"),(0,i.kt)("li",{parentName:"ul"},"la navigation lat\xe9rale ne montre plus que la structure des s\xe9ances et activit\xe9s de la s\xe9quence (cette information \xe9tait cach\xe9e dans la PAD+ pour ne pas surcharger le menu lat\xe9ral).")),(0,i.kt)("p",null,"La nouvelle disposition r\xe9pond \xe0 l'objectif de clart\xe9 et de simplicit\xe9 vis\xe9 pour la navigation de la PAD+ (qui \xe9tait un compromis par rapport \xe0 l'ancienne conception technique). Il est donc propos\xe9 d'utiliser cette nouvelle disposition en ajoutant les \xe9l\xe9ments manquants :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"liens vers la page parcours et les cat\xe9gories disponibles pour les usagers dans la navigation du haut (toutes les s\xe9quences, ateliers compl\xe9mentaires, ressources professionnelles, ...)"),(0,i.kt)("li",{parentName:"ul"},"revoir l'acc\xe8s simplifi\xe9 aux pages annexes dans le menu des onglets (rapports d'activit\xe9 et d'ach\xe8vement)")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Correspondance de la navigation lat\xe9rale entre la PAD+ et Moodle 4",src:n(8098).Z,width:"2600",height:"825"})),(0,i.kt)("p",null,"Dans ce but il faut \xe0 la fois v\xe9rifier les \xe9ventuels changements au m\xe9canisme d'extensions de la navigation et corriger les mod\xe8les et styles surcharg\xe9s, dont certains peuvent \xeatre obsol\xe8tes."),(0,i.kt)("h4",{id:"ic\xf4nes-fontawesome"},"Ic\xf4nes FontAwesome"),(0,i.kt)("p",null,"La biblioth\xe8que FontAwesome du th\xe8me Boost n'a pas chang\xe9 dans Moodle 4. Il s'agit toujours de la version 4.7. Pour rappel, la PAD+ exploite la version 5. Il faut donc v\xe9rifier que cette version reste bien int\xe9gr\xe9e lors de la migration."),(0,i.kt)("h3",{id:"bigbluebutton-moodle4"},"Plugin BigBlueButtonBN et extensions visioconf\xe9rence"),(0,i.kt)("p",null,"Le plugin BigBlueButtonBN n'est plus un plugin externe mais est directement int\xe9gr\xe9 \xe0 Moodle 4. Cependant il a fait l'objet d'une r\xe9\xe9criture en profondeur pour cette int\xe9gration. Cette r\xe9\xe9criture devrait aussi faire l'objet d'une ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/blindsidenetworks/moodle-mod_bigbluebuttonbn"},"release 3.0 pour Moodle 3.11"),"."),(0,i.kt)("p",null,"Cela implique des adaptations pour les fonctionnalit\xe9s visioconf\xe9rence sp\xe9cifiques de la PAD+ (bloc visioconf\xe9rence et appel vid\xe9o page profil), qui ont \xe9t\xe9 d\xe9velopp\xe9es sur la base de la version stable 2.4 du plugin BigBlueButtonBN. Il ne s'agit pas de changements en profondeur mais d'une adaptation des APIs, qui demandent cependant d'\xeatre \xe9tudi\xe9e avec un peu d'attention."),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Proc\xe9dure de migration")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"La proc\xe9dure propos\xe9e est sp\xe9cifique."),(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#cas-dun-plugin-externe-bigbluebuttonbn"},"Supprimer le plugin BigBlueButtonBN")," avant l'int\xe9gration Moodle 4."),(0,i.kt)("li",{parentName:"ul"},"Si besoin d\xe9sactiver/supprimer les extensions PAD+ li\xe9es \xe0 BigBlueButtonBN (par exemple enlever le bloc, enlever les d\xe9pendances entre plugins) pour \xe9viter les erreurs li\xe9s aux fichiers manquant."),(0,i.kt)("li",{parentName:"ul"},"Int\xe9grer Moodle 4."),(0,i.kt)("li",{parentName:"ul"},"Adapter les fonctions du plugin ",(0,i.kt)("inlineCode",{parentName:"li"},"blocks/padplusvideocall")," \xe0 l'API Moodle 4.")))),(0,i.kt)("p",null,"Les impacts des changements dans la PAD+ devraient \xeatre cependant limit\xe9s."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Il s'agit des fichiers ",(0,i.kt)("inlineCode",{parentName:"li"},"blocks/padplusvideocall/lib.php")," et ",(0,i.kt)("inlineCode",{parentName:"li"},"blocks/padplusvideocall/bbbpad_videocall.php"),", qui font tous les deux appellent aux fonctions ",(0,i.kt)("inlineCode",{parentName:"li"},"bigbluebuttonbn_*")," d\xe9finies dans ",(0,i.kt)("inlineCode",{parentName:"li"},"mod/bigbluebuttonbn/locallib.php"),"."),(0,i.kt)("li",{parentName:"ul"},"Sous Moodle 4, ces fonctions sont transform\xe9es en m\xe9thodes dans les classes ",(0,i.kt)("inlineCode",{parentName:"li"},"plugin"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"meeting")," et ",(0,i.kt)("inlineCode",{parentName:"li"},"bigbluebutton_proxy"),". Le tableau ci-dessous donne quelques correspondances pour d\xe9marrer mais il faut cependant creuser la compatibilit\xe9 des instances et des param\xe8tres. Si la classe ",(0,i.kt)("inlineCode",{parentName:"li"},"bigbluebutton_proxy")," est triviale \xe0 utiliser, c'est moins le cas pour la classe ",(0,i.kt)("inlineCode",{parentName:"li"},"meeting"),", qui est li\xe9e aux ",(0,i.kt)("inlineCode",{parentName:"li"},"instances")," des activit\xe9s BigBlueButton dans les s\xe9quences (ce qui n'est pas le cas pour les visioconf\xe9rences directes du tableau de bord et des pages profil). Quelques fonctions seraient possiblement \xe0 extraire pour retrouver une certaine ind\xe9pendance.")),(0,i.kt)("table",null,(0,i.kt)("caption",null,"Migration vers l'API BigBlueButtonBN de Moodle 4."),(0,i.kt)("thead",null,(0,i.kt)("tr",null,(0,i.kt)("th",{scope:"col"},"Fichier PAD+ ",(0,i.kt)("code",null,"blocks/padplusvideocall")),(0,i.kt)("th",{scope:"col"},"Appel \xe0 BigBlueButtonBN 2.4 (actuel)"),(0,i.kt)("th",{scope:"col"},"Appel \xe0 BigBlueButtonBN 3 / Moodle 4"))),(0,i.kt)("tbody",null,(0,i.kt)("tr",null,(0,i.kt)("td",null,(0,i.kt)("code",null,"lib.php")),(0,i.kt)("td",null,(0,i.kt)("code",null,"bigbluebuttonbn_random_password")),(0,i.kt)("td",null,"\xe9quivalent \xe0 ",(0,i.kt)("code",null,"plugin::random_password")," dans ",(0,i.kt)("code",null,"classes/plugin.php"))),(0,i.kt)("tr",null,(0,i.kt)("td",{rowspan:"4",scope:"rowgroup"},(0,i.kt)("code",null,"bbbpad_videocall.php")),(0,i.kt)("td",null,(0,i.kt)("code",null,"bigbluebuttonbn_is_meeting_running")),(0,i.kt)("td",null,"voir ",(0,i.kt)("code",null,"is_running")," dans ",(0,i.kt)("code",null,"classes/meeting.php"))),(0,i.kt)("tr",null,(0,i.kt)("td",null,(0,i.kt)("code",null,"bigbluebuttonbn_get_create_meeting_array")),(0,i.kt)("td",null,"voir ",(0,i.kt)("code",null,"create_meeting_data")," dans ",(0,i.kt)("code",null,"classes/meeting.php"))),(0,i.kt)("tr",null,(0,i.kt)("td",null,(0,i.kt)("code",null,"bigbluebuttonbn_get_error_key")),(0,i.kt)("td",null,"supprim\xe9e, voir ",(0,i.kt)("code",null,"bigbluebutton_exception")," dans ",(0,i.kt)("code",null,"classes/bigbluebutton_proxy.php #create_meeting"))),(0,i.kt)("tr",null,(0,i.kt)("td",null,(0,i.kt)("code",null,"bigbluebuttonbn_get_join_url")),(0,i.kt)("td",null,"voir ",(0,i.kt)("code",null,"get_join_url")," dans ",(0,i.kt)("code",null,"classes/bigbluebutton_proxy.php"))))),(0,i.kt)("h3",{id:"page-mes-s\xe9quences"},'Page "Mes s\xe9quences"'),(0,i.kt)("p",null,'La page "Mes s\xe9quences" est une nouveaut\xe9 de Moodle 4. La page "Mes s\xe9quences" de la PAD+ est un r\xe9troportage. Certains d\xe9veloppements li\xe9s \xe0 cette page deviennent par cons\xe9quent obsol\xe8te (page ',(0,i.kt)("inlineCode",{parentName:"p"},"my/courses.php"),", classes ",(0,i.kt)("inlineCode",{parentName:"p"},"mycourses_renderer.php")," et ",(0,i.kt)("inlineCode",{parentName:"p"},"mycourses_viewed.php")," par exemple) et doivent \xeatre remplac\xe9s par la nouvelle version Moodle 4."),(0,i.kt)("p",null,'Par contre, cette page reste bas\xe9e sur le bloc "Vue d\'ensemble des s\xe9quence", qui est la partie la plus impact\xe9e par les modifications invasives de la PAD+. Il convient l\xe0 de reconsid\xe9rer et tester si les ',(0,i.kt)("a",{parentName:"p",href:"guide#mes-s%C3%A9quences-et-bloc-vue-densemble"},'changements de la PAD+ sur le bloc "Vue d\'ensemble"')," sont bien compatibles sous Moodle 4. Pour rappel, ces modifications sont importantes pour simplifier l'usage de la page \"Mes s\xe9quences\" et la customiser pour l'acc\xe8s aux ressources professionnelles."),(0,i.kt)("h3",{id:"tableau-de-bord"},"Tableau de bord"),(0,i.kt)("p",null,"Le tableau de bord par d\xe9faut de Moodle 4 est all\xe9g\xe9 pour afficher en priorit\xe9 les \xe9v\xe9nements et le calendrier. La vue d'ensemble des s\xe9quences est d\xe9l\xe9gu\xe9e \xe0 la page \"Mes s\xe9quences\", qui peut d'ailleurs \xeatre d\xe9sign\xe9e comme page initiale pour les utilisateurs (sous ",(0,i.kt)("em",{parentName:"p"},"Administration du site / Pr\xe9sentation / Navigation"),"). Il y a donc quelques choix \xe0 reconsid\xe9rer :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'la page "Mes s\xe9quences" doit-elle devenir la page initiale \xe0 la place du tableau de bord ?'),(0,i.kt)("li",{parentName:"ul"},"quels blocs sont \xe0 afficher sur le tableau de bord ?")),(0,i.kt)("p",null,'Il faut noter que seul le tableau de bord peut accueillir les blocs "Progression du stagiaire" et "Visioconf\xe9rence", ce qui peut faire pencher la balance pour garder le tableau de bord comme page initiale.'))}p.isMDXComponent=!0},8098:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/migration-navigation-24438d7d537581483595614c6a936396.png"}}]);